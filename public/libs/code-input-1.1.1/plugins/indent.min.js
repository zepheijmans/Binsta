codeInput.plugins.Indent=class extends codeInput.Plugin{constructor(){super()}afterElementsAdded(a){a.check_tab=this.check_tab,a.check_enter=this.check_enter,a.querySelector("textarea").setAttribute("onkeydown","this.parentElement.check_tab(event); this.parentElement.check_enter(event);")}check_tab(a){if("Tab"!=a.key)return;let b=this.querySelector("textarea"),c=b.value;if(a.preventDefault(),!a.shiftKey&&b.selectionStart==b.selectionEnd){let a=c.slice(0,b.selectionStart),d=c.slice(b.selectionEnd,b.value.length),e=b.selectionEnd+1;b.value=a+"\t"+d,b.selectionStart=e,b.selectionEnd=e}else{let c=b.value.split("\n"),d=0,e=b.selectionStart,f=b.selectionEnd,g=0,h=0;for(let e=0;e<c.length;e++)d+=c[e].length+1,console.log(c[e],": start",b.selectionStart,d,"&& end",b.selectionEnd,d-c[e].length),b.selectionStart<=d&&b.selectionEnd>=d-c[e].length&&(a.shiftKey?"\t"==c[e][0]&&(c[e]=c[e].slice(1),0==g&&h--,g--):(c[e]="\t"+c[e],0==g&&h++,g++));b.value=c.join("\n"),b.selectionStart=e+h,b.selectionEnd=f+g}this.update(b.value)}check_enter(a){if("Enter"!=a.key)return;a.preventDefault();let b=this.querySelector("textarea"),c=b.value.split("\n"),d=0,e=c.length-1,f="",g=0;for(let f=0;f<c.length;f++)if(d+=c[f].length+1,b.selectionEnd<=d){e=f;break}let h=c[e].length-(d-b.selectionEnd)+1;for(let b=0;b<h&&"\t"==c[e][b];b++)g++;let i="";h!=c[e].length&&(i=c[e].substring(h),c[e]=c[e].substring(0,h));for(let b=0;b<g;b++)f+="\t";f+=i;let j=b.selectionStart,k=b.selectionEnd;c.splice(e+1,0,f),b.value=c.join("\n"),b.selectionStart=j+g+1,b.selectionEnd=k+g+1,this.update(b.value)}};